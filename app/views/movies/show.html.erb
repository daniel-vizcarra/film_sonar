<%# app/views/movies/show.html.erb %>
<h1><%= @movie.title %> (<%= @movie.release_year %>)</h1>

<%= image_tag @movie.poster_url, alt: @movie.title, class: "movie-poster-large" if @movie.poster_url.present? %>
<br>

<p><strong>Director/a:</strong> <%= @movie.director&.name %></p>

<% if @movie.genres.any? %>
  <p><strong>Géneros:</strong> <%= @movie.genres.map(&:name).join(', ') %></p>
<% end %>

<%# Mostrar Puntaje Ponderado %>
<% if @movie.weighted_score.present? %>
  <p><strong>Puntaje FilmSonar:</strong> <span style="font-size: 1.2em; font-weight: bold;"><%= "%.1f" % @movie.weighted_score %></span>/100</p>
<% end %>

<%# Mostrar Calificaciones Externas Individuales %>
<% if @movie.external_ratings.any? %>
  <h4>Calificaciones Externas:</h4>
  <ul>
    <% @movie.external_ratings.order(:source_name).each do |rating| %>
      <li>
        <strong><%= rating.source_name %>:</strong> <%= rating.score %>
        <% if rating.vote_count.present? %>
          <small>(de <%= number_with_delimiter(rating.vote_count) %> votos)</small>
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>

<p><strong>Descripción:</strong></p>
<p><%= simple_format(@movie.description) %></p> <%# simple_format ayuda a mantener saltos de línea %>

<hr> <%# Separador opcional %>

<% if user_signed_in? %>
  <% if current_user_has_favorited?(@movie) %>
    <%# Si ya es favorita, muestra el botón para quitarla %>
    <%= button_to "⭐ Quitar de Favoritas", movie_favorite_path(@movie), method: :delete, class: "button-secondary" %>
  <% else %>
    <%# Si no es favorita, muestra el botón para añadirla %>
    <%= button_to "☆ Marcar como Favorita", movie_favorite_path(@movie), method: :post, class: "button" %>
  <% end %>
<% else %>
  <%# Si el usuario no ha iniciado sesión, invítalo a hacerlo %>
  <p><%= link_to "Inicia sesión", new_user_session_path %> o <%= link_to "regrístrate", new_user_registration_path %> para marcar esta película como favorita.</p>
<% end %>

<hr>

<hr>
<%= link_to "Volver al Catálogo", movies_path %>

