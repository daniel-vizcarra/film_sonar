<%# app/views/users/my_favorites.html.erb %>
<h1>My Favorite Movies</h1>

<% if @favorite_movies.any? %>
  <div class="movie-list"> <%# Reutilizamos la clase .movie-list %>
    <% @favorite_movies.each do |movie| %>
      <div class="movie-card"> <%# Reutilizamos la clase .movie-card %>
        <%= link_to movie_path(movie) do %>
          <% if movie.poster_url.present? %>
            <%= image_tag movie.poster_url, alt: movie.title, class: "movie-poster-thumbnail" %>
          <% else %>
            <div class="movie-poster-thumbnail"><span><%= movie.title %></span></div>
          <% end %>
          <h2><%= movie.title %> <span style="font-weight: normal; color: #6c757d;">(<%= movie.release_year %>)</span></h2>
        <% end %>

        <% if movie.director&.name.present? %>
          <p class="movie-card-director"><strong>Dir:</strong> <%= movie.director.name %></p>
        <% end %>

        <% if movie.weighted_score.present? %>
          <p class="movie-card-score">
            <strong>Puntaje:</strong> <%= "%.1f" % movie.weighted_score %>/100
          </p>
        <% end %>

        <%# Botón de Favorito en la tarjeta (para quitarlo) %>
        <% if user_signed_in? %>
          <div class="favorite-action-card" style="margin-top: auto; padding-top: 10px; text-align: right;">
            <%# Usamos el helper definido en favorites_helper.rb o application_helper.rb %>
            <% if current_user_has_favorited?(movie) %> 
              <%= button_to "❤️", movie_favorite_path(movie), method: :delete, class: "button-icon favorited", title: "Quitar de Favoritas" %>
            <% else %>
              <%# Este caso no debería darse aquí si es la lista de favoritos %>
              <%= button_to "🤍", movie_favorite_path(movie), method: :post, class: "button-icon favorite", title: "Marcar como Favorita" %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="pagy-nav-container" style="text-align: center; margin-top: 20px;">
    <%== pagy_nav(@pagy) if @pagy.present? && @pagy.pages > 1 %>
  </div>
<% else %>
  <p>You haven't marked any movies as favorite yet.</p>
  <p><%= link_to "Explore the catalog", movies_path %> to find some!</p>
<% end %>