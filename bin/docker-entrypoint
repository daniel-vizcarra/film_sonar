#!/bin/bash -e

# Enable jemalloc ...
if [ -z "${LD_PRELOAD+x}" ]; then
    LD_PRELOAD=$(find /usr/lib -name libjemalloc.so.2 -print -quit)
    export LD_PRELOAD
fi

echo "==> FilmSonar Entrypoint: Cleaning up old server.pid..."
rm -f /film_sonar/tmp/pids/server.pid # AsegÃºrate que la ruta sea correcta (tu WORKDIR es /rails)

echo "==> FilmSonar Entrypoint: Running rails db:prepare..."
bundle exec rails db:prepare
echo "==> FilmSonar Entrypoint: rails db:prepare finished."

echo "==> FilmSonar Entrypoint: Running rails db:seed..."
bundle exec rails db:seed
echo "==> FilmSonar Entrypoint: rails db:seed finished."

echo "==> FilmSonar Entrypoint: Launching main command (${@})..."
exec "${@}"